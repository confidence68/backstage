<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>励铖软件-我的账号</title>
<link rel="stylesheet" href="css/style.default.css" type="text/css" />

<link rel="stylesheet" href="css/responsive-tables.css">
<script type="text/javascript" src="js/jquery-1.9.1.min.js"></script>
<script type="text/javascript" src="js/jquery-migrate-1.1.1.min.js"></script>
<script type="text/javascript" src="js/jquery-ui-1.9.2.min.js"></script>
<script type="text/javascript" src="js/modernizr.min.js"></script>
<script type="text/javascript" src="js/bootstrap.min.js"></script>
<script type="text/javascript" src="js/jquery.cookie.js"></script>
<script type="text/javascript" src="js/flot/jquery.flot.min.js"></script>
<script type="text/javascript" src="js/flot/jquery.flot.resize.min.js"></script>
<script type="text/javascript" src="js/responsive-tables.js"></script>
<script type="text/javascript" src="js/custom.js"></script>
<!--[if lte IE 8]><script language="javascript" type="text/javascript" src="js/excanvas.min.js"></script><![endif]-->
<link rel="stylesheet" type="text/css" href="js/changehead/css/imgareaselect-default.css" />

<script type="text/javascript" src="js/changehead/scripts/jquery.imgareaselect.pack.js"></script>
<script type="text/javascript" src="js/changehead/scripts/jQueryRotate.js"></script>
<script type="text/javascript">
jQuery(document).ready(function(){

    
    jQuery('.taglist .close').click(function(){
        jQuery(this).parent().remove();
        return false;
    });
    
});

</script>
<style type="text/css">
.changeheads{width:720px;height:400px;margin-top:20px;}
.portrait_left{float:left;height:auto;width:306px;}
#preview{border:1px solid #000000;overflow:hidden;position:relative;height:auto;width:280px;margin:0 auto;}
#avatar{height:280px;filter:progid:DXImageTransform.Microsoft.AlphaImageLoader(sizingMethod=image);}
.portrait_revolve{height:auto;padding-top:15px;width:306px;}
.revolve_left{background:url("js/changehead/images/btn.gif") no-repeat 0px 0px;float:left;height:22px;width:22px;}
.revol_left_txt{color:#FF6699;float:left;height:22px;line-height:22px;text-align:left;width:110px;}
.revol_left_txt{color:#FF6699;float:left;height:22px;line-height:22px;text-align:left;width:110px;}
.revol_right_txt{color:#FF6699;float:left;height:22px;line-height:22px;text-align:right;width:131px;}
.revolve_right{background:url("js/changehead/images/btn.gif") no-repeat scroll -18px 0px;float:left;height:22px;width:22px;}
.setup_but{height:28px;padding-left:50px;padding-top:40px;width:auto;}
.baseinf_but1{background:url("js/changehead/images/btn.gif") no-repeat 0px -22px;border:medium none;color:#FFFFFF;font-size:14px;font-weight:bold;height:28px;line-height:28px;margin-right:22px;outline:medium none;width:78px;}
.portrait_right{float:left;font-size:12px;height:280px;padding-left:80px;width:320px;}
.portrait_right_bottom{color:#666666;height:220px;width:310px;}
.portrait1{float:left;height:200px;width:180px;}
#img_big_preview{height:180px;margin:0 auto;width:180px;}
.img_preview{border:1px solid #000000;overflow:hidden;position:relative;}
.img_preview img{margin:0;position:relative;max-width: 200%;}
.portrait2{float:left;height:auto;padding-left:40px;width:68px;}
#img_small_preview{height:49px;margin:0 auto;width:49px;}
.img_preview{border:1px solid #000000;overflow:hidden;position:relative;}
#preview img{max-width: 200%;width:280px;}
.afile input {
    position: absolute;
    font-size: 100px;
    right: 0;
    top: 0;
    opacity: 0;
}
.headqueding{color: #fff;
background: #3b6c8e;
padding: 8px 20px;
border-radius: 3px;
display: inline-block;
font-size: 16px;
cursor: pointer;
border: none;
font-weight: bold;
margin-top:10px;margin-left:20px;
}
</style>
</head>

<body>

<div class="mainwrapper">
    
    <div class="header">
        <div class="logo">
            <a href="#"><img src="images/logo.png" alt="" /></a>
        </div>
        <div class="headerinner">
            <ul class="headmenu">
                <li class="odd">
                    <a class="dropdown-toggle"  href="index.html">
                        <span class="head-icon head-home"></span>
                        <span class="headmenu-label">首页</span>
                    </a>
                </li>
                <li>
                    <a class="dropdown-toggle" data-toggle="dropdown" data-target="#">
                    <span class="count">10</span>
                    <span class="head-icon head-meeting"></span>
                    <span class="headmenu-label">会议</span>
                    </a>
                    <ul class="dropdown-menu" style="width:220px;">
                        <li class="nav-header">会议</li>
                        <li><a href=""><span class="icon-envelope fl"></span> <div class="meetingname" title="某某某会议某某某会议">某某某会议某某某会议</div><strong class="gname">张三</strong> <small class="muted fl">19小时</small></a></li>
                        <li><a href=""><span class="icon-envelope fl"></span> <div class="meetingname" title="某某某会议某某某会议">某某某会议</div><strong class="gname">张三</strong> <small class="muted fl">19小时</small></a></li>
                        <li><a href=""><span class="icon-envelope fl"></span> <div class="meetingname" title="某某某会议某某某会议">某某某会议</div><strong class="gname">张三</strong> <small class="muted fl">19小时</small></a></li>
                        <li><a href=""><span class="icon-envelope fl"></span> <div class="meetingname" title="某某某会议某某某会议">某某某会议</div><strong class="gname">张三</strong> <small class="muted fl">19小时</small></a></li>
                        <li><a href=""><span class="icon-envelope fl"></span> <div class="meetingname" title="某某某会议某某某会议">某某某会议</div><strong class="gname">张三</strong> <small class="muted fl">19小时</small></a></li>
                        <li><a href=""><span class="icon-envelope fl"></span> <div class="meetingname" title="某某某会议某某某会议">某某某会议</div><strong class="gname">张三</strong> <small class="muted fl">19小时</small></a></li>
                        <li class="viewmore"><a href="meeting.html">更多</a></li>
                    </ul>
                </li>
                <li class="odd" class="sj_shejiao">
                    <a class="dropdown-toggle" href="shejiao.html">
                    <span class="count">1</span>
                    <span class="head-icon head-shejiao"></span>
                    <span class="headmenu-label">社交</span>
                    </a>
                </li>
                <li class="ht_background">
                    <a class="dropdown-toggle" href="backmanage.html">
                    <span class="count">1</span>
                    <span class="head-icon head-backmanage"></span>
                    <span class="headmenu-label">后台管理</span>
                    </a>
                </li>
                <li class="odd wp_cloud">
                    <a class="dropdown-toggle"  href="cloud.html">
                    <span class="count">1</span>
                    <span class="head-icon head-cloud"></span>
                    <span class="headmenu-label">网盘</span>
                    </a>
                </li>
                <li class="right">
                    <div class="userloggedinfo">
                        <img src="images/photos/thumb1.png" alt="" />
                        <div class="userinfo">
                            <h5>小胖 <small>- pang@hotmail.com</small></h5>
                            <ul>
                                <li><a href="my_info.html">编辑信息</a></li>
                                <li><a href="">账号管理</a></li>
                                <li><a href="index.html">退出</a></li>
                            </ul>
                        </div>
                    </div>
                </li>
            </ul><!--headmenu-->
        </div>
    </div>
    
    <div class="leftpanel">
        
        <div class="leftmenu">        
            <ul class="nav nav-tabs nav-stacked">
            	<li class="nav-header">导航</li>
                <li><a href="index.html"><span class="fa fa-home"></span> 首页</a></li>
                <li><a href="my_info.html"><span class="fa fa-user"></span> 我的账号</a></li>
                <li  class="active"><a href="changehead.html"><span class="fa fa-pencil-square-o"></span> 修改头像</a></li>
                <li><a href="changepassword.html"><span class="fa fa-key"></span> 修改密码</a></li>
                <li><a href="mp.html"><span class="fa fa-newspaper-o"></span> 我的名片</a></li>
                <li><a href="dongtai.html"><span class="fa fa-comment"></span>我的动态</a></li>
                <li><a href="pay_info.html"><span class="fa fa-paypal"></span> 付费信息</a></li>
            </ul>
        </div><!--leftmenu-->
        
    </div><!-- leftpanel -->
    
    <div class="rightpanel">
        
        <ul class="breadcrumbs">
            <li><a href="meeting.html"><i class="fa fa-home"></i></a> <span class="separator"></span></li>
            <li>我的账号</li>
            <li class="right">
                    <a href="" data-toggle="dropdown" class="dropdown-toggle"><i class="icon-tint"></i> 皮肤颜色</a>
                    <ul class="dropdown-menu pull-right skin-color">
                        <li><a href="default">默认颜色</a></li>
                        <li><a href="blue">蓝色</a></li>
                        <li><a href="palegreen">军绿色</a></li>
                        <li><a href="red">红色</a></li>
                        <li><a href="green">绿色</a></li>
                        <li><a href="brown">棕色</a></li>
                    </ul>
            </li>
        </ul>
        
        <div class="pageheader">
            <div class="pageicon"><span class="fa fa-user"></span></div>
            <div class="pagetitle">
                <h5>Change Head</h5>
                <h1 style="margin-top:6px;">修改头像</h1>
            </div>
        </div><!--pageheader-->
        
        <div class="maincontent">
            <div class="maincontentinner">
                <div class="row-fluid">
                <div class="changeheads">

                <div class="portrait_left">
                
                    <div id="preview"><img id="avatar" alt="请上传头像" src="js/changehead/images/Koala_cropped.jpg"></div>
                    
                    <form id="crop_form" method="post" action=".">
                        <!--通过生成尺寸和旋转角度 后台获取尺寸和旋转角度再进行裁剪-->
                        <input id="id_top" type="hidden" name="top" value="90">
                        <input id="id_left" type="hidden" name="left" value="61">
                        <input id="id_right" type="hidden" name="right" value="201">
                        <input id="id_bottom" type="hidden" name="bottom" value="200">
                        <input id="rotation" type="hidden" value="0" name="rotation">
                    </form>
                    
                    <div class="portrait_revolve">
                        <div class="revolve_left"></div>
                        <a href="javascript:;" class="revol_left_txt" onClick="avatarrotateleft();">向左旋转</a>
                        <a href="javascript:;" class="revol_right_txt" onClick="avatarrotateright();">向右旋转</a>
                        <div class="revolve_right"></div>
                    </div>
                    
                    <div class="setup_but">  <a class="afile" href="javascript:void(0)">选择图片<input type="file" accept="image/png,image/gif,image/jpeg" onchange="previewImage(this)" /></a>

                      <input type="button" class="headqueding" value="确定" onClick="submit_avatar();">

                    </div>
                </div>


                <div class="portrait_right">
                
                    <p class="portrait_right_txt">您上传的头像会自动生成小尺寸头像，请注意小尺寸的头像是否清晰</p>
                
                    <div class="portrait_right_bottom">
                        <div class="portrait1">
                            <div id="img_big_preview" class="img_preview"><img id="avatar1" alt="头像预览" src="js/changehead/images/Koala_cropped.jpg" style="width:360px;height:360px;max-width: 200%;margin-left:-117px;margin-top:-44px;" /></div>
                            <p>大尺寸头像，180×180</p>
                        </div>
                    </div>
                    <div class="portrait2">
                        <div id="img_small_preview" class="img_preview"><img id="avatar2" alt="预览" src="js/changehead/images/Koala_cropped.jpg" style="width: 98px;max-width: 200%; height: 98px; margin-left: -32px; margin-top: -12px;"></div>
                        <p>中尺寸头像</p>
                        <p>50×50</p>
                    </div>
                </div>
              </div>
                </div><!--tabbedwidget-->
                        
                
                <div class="footer">
                    <div class="footer-left">
                        <span>&copy; 2014. 上海励铖软件. All Rights Reserved.</span>
                    </div>
                    <div class="footer-right">
                        <span>Power by: <a href="">上海励铖软件</a></span>
                    </div>
                </div><!--footer-->
                
            </div><!--maincontentinner-->
        </div><!--maincontent-->
        
    </div><!--rightpanel-->
    
</div><!--mainwrapper-->
<script type="text/javascript">
jQuery(document).ready(function (){
    function adjust(el, selection) {
        var scaleX = jQuery(el).width() / (selection.width || 1);
        var scaleY = jQuery(el).height() / (selection.width || 1);
        jQuery(el+' img').css({
            width: Math.round(scaleX*jQuery('#avatar').width() ) + 'px',
            height: Math.round(scaleY*jQuery('#avatar').height() ) + 'px',
            marginLeft: '-' + Math.round(scaleX * selection.x1) + 'px',
            marginTop: '-' + Math.round(scaleY * selection.y1) + 'px'
        });
    }
    function preview(img, selection) {
        adjust('#img_small_preview', selection);
        adjust('#img_big_preview', selection);
    }
    jQuery('#avatar').imgAreaSelect({
        aspectRatio: "4:4",
        x1: 60,
        y1:60,
        x2: 200,
        y2: 200,
        onSelectEnd:function(img, selection) {
            jQuery('#id_top').val(selection.y1);
            jQuery('#id_left').val(selection.x1);
            jQuery('#id_right').val(selection.x2);
            jQuery('#id_bottom').val(selection.y2);
        },
        onSelectChange: preview
    });
}); 



var value = 0;
function avatarrotateleft(){
    value -=90;
    jQuery('#avatar').rotate({ animateTo:value});
    jQuery('#avatar1').rotate({ animateTo:value});
    jQuery('#avatar2').rotate({ animateTo:value});
}
function avatarrotateright(){
    value +=90;
    jQuery('#avatar').rotate({ animateTo:value});
    jQuery('#avatar1').rotate({ animateTo:value});
    jQuery('#avatar2').rotate({ animateTo:value});
}
function select_avatar(){
    jQuery('#avatar_id').click();
}
function uploadavatar(){
    jQuery('#avatar_form').submit();
}
function submit_avatar(){
    jQuery('#rotation').val(value);
    alert('修改成功');
    jQuery('#crop_form').submit();
} 

     //图片上传预览    IE是用了滤镜。
        function previewImage(file)
        {
          var MAXWIDTH  = 260; 
          var MAXHEIGHT = 180;
          var div = document.getElementById('preview');
          var div1 = document.getElementById('img_big_preview');
          var div2 = document.getElementById('img_small_preview');
          if (file.files && file.files[0])
          {
              div.innerHTML ='<img id=avatar>';
              var img = document.getElementById('avatar');
              img.onload = function(){
                var rect = clacImgZoomParam(MAXWIDTH, MAXHEIGHT, img.offsetWidth, img.offsetHeight);
                img.width  =  rect.width;
                img.height =  rect.height;
//                 img.style.marginLeft = rect.left+'px';
                img.style.marginTop = rect.top+'px';
              }
              var reader = new FileReader();
              reader.onload = function(evt){img.src = evt.target.result;}
              reader.readAsDataURL(file.files[0]);
              
              div1.innerHTML ='<img id=avatar1>';
              var img1 = document.getElementById('avatar1');
              img1.onload = function(){
                var rect = clacImgZoomParam(MAXWIDTH, MAXHEIGHT, img1.offsetWidth, img1.offsetHeight);
                img1.width  =  360;
                img1.height =  360;
//                 img.style.marginLeft = rect.left+'px';
                img1.style.marginTop = rect.top+'px';
              }
              var reader1 = new FileReader();
              reader1.onload = function(evt){img1.src = evt.target.result;}
              reader1.readAsDataURL(file.files[0]);
              
              
              div2.innerHTML ='<img id=avatar2>';
              var img2 = document.getElementById('avatar2');
              img2.onload = function(){
                var rect = clacImgZoomParam(MAXWIDTH, MAXHEIGHT, img2.offsetWidth, img2.offsetHeight);
                img2.width  = 360;
                img2.height = 360;
//                 img.style.marginLeft = rect.left+'px';
                img2.style.marginTop = rect.top+'px';
              }
              var reader2 = new FileReader();
              reader2.onload = function(evt){img2.src = evt.target.result;}
              reader2.readAsDataURL(file.files[0]);
          }
          else //兼容IE
          {
            var sFilter='filter:progid:DXImageTransform.Microsoft.AlphaImageLoader(sizingMethod=scale,src="';
            file.select();
            var src = document.selection.createRange().text;
            div.innerHTML = '<img id=avatar>';
            var img = document.getElementById('avatar');
            img.filters.item('DXImageTransform.Microsoft.AlphaImageLoader').src = src;
            var rect = clacImgZoomParam(MAXWIDTH, MAXHEIGHT, img.offsetWidth, img.offsetHeight);
            status =('rect:'+rect.top+','+rect.left+','+rect.width+','+rect.height);
            div.innerHTML = "<div id=divhead style='width:"+rect.width+"px;height:"+rect.height+"px;margin-top:"+rect.top+"px;"+sFilter+src+"\"'></div>";
          }
        }
        function clacImgZoomParam( maxWidth, maxHeight, width, height ){
            var param = {top:0, left:0, width:width, height:height};
            if( width>maxWidth || height>maxHeight )
            {
                rateWidth = width / maxWidth;
                rateHeight = height / maxHeight;
                
                if( rateWidth > rateHeight )
                {
                    param.width =  maxWidth;
                    param.height = Math.round(height / rateWidth);
                }else
                {
                    param.width = Math.round(width / rateHeight);
                    param.height = maxHeight;
                }
            }
            
            param.left = Math.round((maxWidth - param.width) / 2);
            param.top = Math.round((maxHeight - param.height) / 2);
            return param;
        }
</script>
</body>
</html>
